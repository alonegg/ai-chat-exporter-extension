<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chat Extraction Debug Tool</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .debug-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            background: #fafafa;
        }
        
        .debug-section h3 {
            margin-top: 0;
            color: #333;
        }
        
        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            margin: 5px;
        }
        
        button:hover {
            opacity: 0.9;
        }
        
        #results {
            max-height: 400px;
            overflow-y: auto;
            background: #f8f8f8;
            border: 1px solid #ddd;
            border-radius: 6px;
            padding: 15px;
            font-family: monospace;
            font-size: 12px;
            white-space: pre-wrap;
        }
        
        .element-info {
            background: #e3f2fd;
            border: 1px solid #2196f3;
            border-radius: 4px;
            padding: 10px;
            margin: 10px 0;
        }
        
        .warning {
            background: #fff3cd;
            border: 1px solid #ffc107;
            color: #856404;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîç AI Chat Exporter - Debug Tool</h1>
        <p>This tool helps debug content extraction issues. Open this page on any AI chat website to analyze the page structure.</p>
        
        <div class="warning">
            <strong>Instructions:</strong>
            <ol>
                <li>Navigate to your AI chat conversation (ChatGPT, Claude, Gemini, etc.)</li>
                <li>Make sure the conversation is fully loaded</li>
                <li>Open this HTML file in the same browser tab (replace the AI chat page)</li>
                <li>Use the buttons below to analyze the page structure</li>
            </ol>
        </div>
        
        <div class="debug-section">
            <h3>üåê Platform Detection</h3>
            <button onclick="detectPlatform()">Detect Platform</button>
            <button onclick="analyzePageStructure()">Analyze Page Structure</button>
            <div id="platformInfo"></div>
        </div>
        
        <div class="debug-section">
            <h3>üîç Element Scanning</h3>
            <button onclick="scanForMessages()">Scan for Messages</button>
            <button onclick="scanBySelectors()">Test Selectors</button>
            <button onclick="findTextElements()">Find Text Elements</button>
        </div>
        
        <div class="debug-section">
            <h3>üß™ Extraction Testing</h3>
            <button onclick="testChatGPTExtraction()">Test ChatGPT</button>
            <button onclick="testClaudeExtraction()">Test Claude</button>
            <button onclick="testGeminiExtraction()">Test Gemini</button>
            <button onclick="testGenericExtraction()">Test Generic</button>
        </div>
        
        <div class="debug-section">
            <h3>üìä Results</h3>
            <button onclick="clearResults()">Clear Results</button>
            <div id="results"></div>
        </div>
    </div>

    <script>
        let debugResults = [];
        
        function log(message, data = '') {
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = `[${timestamp}] ${message}`;
            if (data) {
                console.log(logEntry, data);
                debugResults.push(logEntry + '\n' + JSON.stringify(data, null, 2) + '\n');
            } else {
                console.log(logEntry);
                debugResults.push(logEntry + '\n');
            }
            updateResults();
        }
        
        function updateResults() {
            document.getElementById('results').textContent = debugResults.join('\n');
            document.getElementById('results').scrollTop = document.getElementById('results').scrollHeight;
        }
        
        function clearResults() {
            debugResults = [];
            updateResults();
        }
        
        function detectPlatform() {
            const hostname = window.location.hostname;
            let platform = 'unknown';
            
            if (hostname.includes('chatgpt.com') || hostname.includes('chat.openai.com')) {
                platform = 'ChatGPT';
            } else if (hostname.includes('claude.ai')) {
                platform = 'Claude';
            } else if (hostname.includes('gemini.google.com')) {
                platform = 'Gemini';
            } else if (hostname.includes('poe.com')) {
                platform = 'Poe';
            }
            
            const info = {
                hostname: hostname,
                platform: platform,
                url: window.location.href,
                userAgent: navigator.userAgent
            };
            
            log('Platform Detection:', info);
            
            document.getElementById('platformInfo').innerHTML = `
                <div class="element-info">
                    <strong>Platform:</strong> ${platform}<br>
                    <strong>Hostname:</strong> ${hostname}<br>
                    <strong>URL:</strong> ${window.location.href}
                </div>
            `;
        }
        
        function analyzePageStructure() {
            const structure = {
                totalElements: document.querySelectorAll('*').length,
                divs: document.querySelectorAll('div').length,
                spans: document.querySelectorAll('span').length,
                paragraphs: document.querySelectorAll('p').length,
                articles: document.querySelectorAll('article').length,
                sections: document.querySelectorAll('section').length,
                mains: document.querySelectorAll('main').length
            };
            
            log('Page Structure Analysis:', structure);
        }
        
        function scanForMessages() {
            const selectors = [
                // ChatGPT selectors
                '[data-message-author-role]',
                '.group.w-full',
                '[class*="markdown"]',
                '[class*="prose"]',
                
                // Claude selectors
                '[data-testid="conversation-turn"]',
                '.conversation-turn',
                '[class*="ConversationTurn"]',
                '[data-testid="user-message"]',
                '[data-testid="message-content"]',
                
                // Gemini selectors
                'message-content',
                '.message-content',
                '.model-response-text',
                '.query-text',
                '[class*="message"]',
                '[class*="response"]',
                '[class*="query"]',
                
                // Poe selectors
                '.ChatMessage_messageRow__DHlnq',
                '[class*="ChatMessage"]',
                '[class*="messageRow"]',
                
                // Generic selectors
                '[class*="Message"]',
                '[role="presentation"]',
                'div[data-message-id]'
            ];
            
            const results = {};
            
            selectors.forEach(selector => {
                try {
                    const elements = document.querySelectorAll(selector);
                    if (elements.length > 0) {
                        results[selector] = {
                            count: elements.length,
                            samples: Array.from(elements).slice(0, 3).map(el => ({
                                tagName: el.tagName,
                                className: el.className,
                                textPreview: (el.textContent || '').substring(0, 100) + '...',
                                attributes: Array.from(el.attributes).map(attr => `${attr.name}="${attr.value}"`)
                            }))
                        };
                    }
                } catch (e) {
                    results[selector] = { error: e.message };
                }
            });
            
            log('Message Element Scan:', results);
        }
        
        function scanBySelectors() {
            const commonPatterns = [
                'div[class*="message"]',
                'div[class*="Message"]',
                'div[class*="chat"]',
                'div[class*="Chat"]',
                'div[class*="conversation"]',
                'div[class*="Conversation"]',
                'div[class*="turn"]',
                'div[class*="Turn"]'
            ];
            
            const results = {};
            
            commonPatterns.forEach(pattern => {
                const elements = document.querySelectorAll(pattern);
                if (elements.length > 0) {
                    results[pattern] = elements.length;
                }
            });
            
            log('Selector Pattern Scan:', results);
        }
        
        function findTextElements() {
            const textElements = [];
            const allElements = document.querySelectorAll('*');
            
            allElements.forEach(el => {
                const text = (el.innerText || el.textContent || '').trim();
                
                if (text.length > 50 && text.length < 5000 &&
                    el.tagName !== 'SCRIPT' && 
                    el.tagName !== 'STYLE' &&
                    !el.closest('nav') &&
                    !el.closest('header') &&
                    !el.closest('footer')) {
                    
                    // Check if this is a leaf element
                    const hasChildWithSameText = Array.from(el.children).some(child => 
                        (child.innerText || child.textContent || '').trim() === text
                    );
                    
                    if (!hasChildWithSameText) {
                        textElements.push({
                            tagName: el.tagName,
                            className: el.className,
                            textLength: text.length,
                            textPreview: text.substring(0, 200) + (text.length > 200 ? '...' : ''),
                            position: el.getBoundingClientRect().top + window.scrollY
                        });
                    }
                }
            });
            
            // Sort by position
            textElements.sort((a, b) => a.position - b.position);
            
            log('Text Elements Found:', {
                count: textElements.length,
                elements: textElements.slice(0, 10) // Show first 10
            });
        }
        
        function testChatGPTExtraction() {
            log('Testing ChatGPT extraction...');
            
            const strategies = [
                {
                    name: 'data-message-author-role',
                    selector: '[data-message-author-role]',
                    getRoleFromElement: (el) => el.getAttribute('data-message-author-role')
                },
                {
                    name: 'group.w-full',
                    selector: '.group.w-full',
                    getRoleFromElement: (el) => el.querySelector('.text-gray-800') ? 'assistant' : 'user'
                }
            ];
            
            strategies.forEach(strategy => {
                const elements = document.querySelectorAll(strategy.selector);
                log(`ChatGPT Strategy "${strategy.name}":`, {
                    elementsFound: elements.length,
                    sample: elements.length > 0 ? {
                        role: strategy.getRoleFromElement(elements[0]),
                        textPreview: (elements[0].textContent || '').substring(0, 100)
                    } : null
                });
            });
        }
        
        function testClaudeExtraction() {
            log('Testing Claude extraction...');
            
            const selectors = [
                '[data-testid="conversation-turn"]',
                '.conversation-turn',
                '[data-testid="user-message"]',
                '[data-testid="message-content"]'
            ];
            
            selectors.forEach(selector => {
                const elements = document.querySelectorAll(selector);
                log(`Claude selector "${selector}":`, {
                    count: elements.length,
                    sample: elements.length > 0 ? (elements[0].textContent || '').substring(0, 100) : null
                });
            });
        }
        
        function testGeminiExtraction() {
            log('Testing Gemini extraction...');
            
            const selectors = [
                'message-content',
                '.message-content',
                '.model-response-text',
                '.query-text',
                '[class*="message"]',
                '[class*="response"]',
                '[class*="query"]'
            ];
            
            selectors.forEach(selector => {
                const elements = document.querySelectorAll(selector);
                log(`Gemini selector "${selector}":`, {
                    count: elements.length,
                    sample: elements.length > 0 ? (elements[0].textContent || '').substring(0, 100) : null
                });
            });
        }
        
        function testGenericExtraction() {
            log('Testing generic extraction...');
            
            // Simulate generic extraction logic
            const textElements = [];
            const allElements = document.querySelectorAll('*');
            
            allElements.forEach(el => {
                const text = (el.innerText || el.textContent || '').trim();
                
                if (text.length > 20 && 
                    text.length < 10000 &&
                    el.tagName !== 'SCRIPT' && 
                    el.tagName !== 'STYLE' &&
                    !el.closest('nav') &&
                    !el.closest('header') &&
                    !el.closest('footer') &&
                    !el.querySelector('button')) {
                    
                    const hasChildWithSameText = Array.from(el.children).some(child => 
                        (child.innerText || child.textContent || '').trim() === text
                    );
                    
                    if (!hasChildWithSameText) {
                        textElements.push(text);
                    }
                }
            });
            
            log('Generic Extraction Result:', {
                totalElements: textElements.length,
                samples: textElements.slice(0, 5).map(text => text.substring(0, 100) + '...')
            });
        }
        
        // Auto-detect platform on load
        window.addEventListener('load', () => {
            setTimeout(detectPlatform, 500);
        });
    </script>
</body>
</html>